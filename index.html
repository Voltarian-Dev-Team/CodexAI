<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebLyne DOOM®</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon.ico" />
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f5f5f5;
      font-family:
        system-ui,
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI",
        Roboto,
        Oxygen,
        Ubuntu,
        Cantarell,
        "Open Sans",
        "Helvetica Neue",
        sans-serif;
      user-select: none;
      position: fixed;
      width: 100%;
      overflow: hidden;
    }

    .weblyne-container {
      border: 1px solid #ccc;
      background-color: white;
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    .weblyne-container:focus {
      box-shadow: 0 0 0 3px rgba(33, 37, 41, 0.3);
    }

    .weblyne-header {
      background-color: #212529;
      color: white;
      padding: 16px;
      margin: 5px;
      margin-bottom: 0;
    }

    .weblyne-header h2 {
      margin: 0;
      font-size: 14px;
      font-weight: normal;
    }

    .weblyne-header p {
      margin: 4px 0 0;
      font-size: 22px;
      font-weight: bold;
    }

    .weblyne-canvas-container {
      margin: 5px;
      min-width: 420px;
      min-height: 300px;
      width: 460px;
      aspect-ratio: 16 / 10;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #999;
      font-size: 14px;
      resize: horizontal;
      overflow: auto;
    }

    @media (min-width: 768px) {
      .weblyne-canvas-container {
        width: 580px;
      }
    }

    .weblyne-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      image-rendering: pixelated;
      pointer-events: none;
      opacity: 0.8;
      transition: opacity 0.15s ease;
    }

    .weblyne-container:focus .weblyne-canvas {
      opacity: 1;
    }

    .weblyne-footer {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 5px;
      border-top: 1px solid #ccc;
    }

    .weblyne-controls {
      display: flex;
      gap: 12px;
    }

    .weblyne-button {
      border: none;
      padding: 0 16px;
      border-radius: 4px;
      font-size: 14px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .weblyne-refresh-button {
      background-color: #e0e0e0;
      color: #444;
      cursor: pointer;
    }

    .weblyne-refresh-button:hover {
      background-color: #d0d0d0;
    }

    .weblyne-refresh-button:active {
      background-color: #c0c0c0;
    }

    .weblyne-refresh-icon {
      width: 14px;
      height: 14px;
      fill: #444;
    }

    .weblyne-back-button {
      background-color: #e0e0e0;
      color: #444;
      cursor: pointer;
    }

    .weblyne-back-button:hover {
      background-color: #d0d0d0;
    }

    .weblyne-back-button:active {
      background-color: #c0c0c0;
    }

    .weblyne-back-icon {
      width: 14px;
      height: 14px;
      fill: #444;
    }

    .weblyne-killcount-button {
      position: relative;
      background-color: #f0f0f0;
      min-width: 70px;
      color: #888;
      pointer-events: none;
      cursor: default;
      padding: 0 12px 0 24px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    .success-message {
      color: #000;
      display: none;
      text-align: center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    .success-message h2 {
      margin: 0 0 10px 0;
      font-size: 18px;
      color: #212529;
    }

    .success-message a {
      color: #212529;
      text-decoration: none;
    }

    .success-message a:hover {
      text-decoration: underline;
    }

    @keyframes killFlash {
      0% {
        background-color: #212529;
      }

      100% {
        background-color: var(--end-color, #f0f0f0);
      }
    }

    @keyframes iconFlash {
      0% {
        fill: white;
      }

      100% {
        fill: var(--end-icon-color, #888888);
      }
    }

    .weblyne-killcount-icon {
      width: 18px;
      height: 18px;
      position: absolute;
      left: 8px;
    }

    .weblyne-killcount-button span {
      font-weight: 600;
    }

    .status-message {
      position: absolute;
      left: 0;
      right: 0;
      text-align: center;
      color: #888;
      font-size: 14px;
      display: none;
    }

    .status-message.focus {
      display: none;
    }

    .status-message.death {
      color: #f44;
      display: none;
    }

    .status-message.instructions {
      color: #666;
      display: none;
    }

    /* Show "Tap to play" when not focused, regardless of death state */
    .weblyne-container:not(:focus) .status-message.focus {
      display: block;
    }

    /* Show instructions when focused and not dead */
    .weblyne-container:focus .status-message.instructions {
      display: block;
    }

    /* Only show death message when focused */
    .weblyne-container:focus .status-message.death.visible {
      display: block;
    }

    /* Hide instructions when death message is visible */
    .weblyne-container:focus .status-message.death.visible~.status-message.instructions {
      display: none;
    }

    .vtd-footer {
      position: fixed;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: #666;
    }

    .vtd-footer a {
      color: inherit;
      text-decoration: none;
    }

    .vtd-footer a:hover {
      text-decoration: underline;
    }

    /* Mobile controls */
    .mobile-controls {
      display: none;
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      padding: 10px;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    @media (hover: none) and (pointer: coarse) {
      .weblyne-container:focus .mobile-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* Hide keyboard instructions when showing touch controls */
      .weblyne-container:focus .status-message.instructions {
        display: none;
      }
    }

    .d-pad {
      display: grid;
      grid-template-columns: repeat(3, 40px);
      grid-template-rows: repeat(3, 40px);
      gap: 5px;
      pointer-events: auto;
    }

    .fire-button {
      width: fit-content;
      height: fit-content;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      fill: white;
      color: white;
      pointer-events: auto;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .use-button {
      width: fit-content;
      height: fit-content;
      border-radius: 50%;
      fill: white;
      color: white;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      pointer-events: auto;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .d-pad button {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .d-pad button:active,
    .fire-button:active,
    .use-button:active {
      background: rgba(255, 255, 255, 0.3);
    }

    .d-pad .up {
      grid-column: 2;
      grid-row: 1;
    }

    .d-pad .left {
      grid-column: 1;
      grid-row: 2;
    }

    .d-pad .right {
      grid-column: 3;
      grid-row: 2;
    }

    .d-pad .down {
      grid-column: 2;
      grid-row: 3;
    }

    .seperator {
      margin: 0 4px;
      opacity: 0.5;
    }

    .vtd-love-icon {
      width: 12px;
      height: 12px;
      fill: #c33;
      transform: translateY(2.5px);
    }
    
    .weblyne-key {
    display: inline-block;
    padding: 0.2em 0.4em;
    font-size: 90%;
    color: #333;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #bbb;
  }
  </style>
</head>

<body>
  <footer class="vtd-footer">
    <a target="_blank" href="https://github.com/Voltarian-Dev-Team/">Voltarian Dev Team</a>
    <span class="seperator">|</span>
    <a target="_blank" href="https://github.com/Voltarian-Dev-Team/WebLyne.DOOM">Source Code</a>
  </footer>

  <div class="weblyne-container" tabindex="1">
    <div class="weblyne-header">
      <p>WebLyne DOOM®</p>
    </div>

    <div class="weblyne-canvas-container">
      <div id="status">Downloading...</div>
      <progress id="progress" value="0" max="100" hidden></progress>
      <canvas class="weblyne-canvas" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
      <div class="mobile-controls">
        <div class="d-pad">
          <button class="up">↑</button>
          <button class="left">←</button>
          <button class="right">→</button>
          <button class="down">↓</button>
        </div>
        <button class="fire-button"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
            viewBox="0 0 552.122 552.122" xml:space="preserve">
            <path
              d="M30.601 306.661h14.253c13.721 104.187 96.42 186.887 200.607 200.607v14.254c0 16.896 13.703 30.6 30.6 30.6s30.599-13.703 30.599-30.6v-14.254c104.188-13.721 186.887-96.414 200.607-200.607h14.254c16.898 0 30.6-13.703 30.6-30.601 0-16.897-13.701-30.6-30.6-30.6h-14.254C493.546 141.273 410.847 58.574 306.66 44.853V30.6c0-16.897-13.701-30.6-30.599-30.6-16.897 0-30.6 13.703-30.6 30.6v14.253C141.274 58.575 58.575 141.268 44.854 245.461H30.601c-16.897 0-30.6 13.703-30.6 30.6-.001 16.897 13.702 30.6 30.6 30.6m214.86-199.897v84.462c9.565-3.452 19.841-5.435 30.6-5.435s21.035 1.983 30.599 5.435v-84.462c70.393 12.693 126.006 68.305 138.699 138.697h-84.463c3.451 9.566 5.434 19.841 5.434 30.6s-1.982 21.035-5.434 30.601h84.463c-12.693 70.393-68.307 126.005-138.699 138.697v-84.462c-9.564 3.452-19.84 5.435-30.599 5.435s-21.035-1.982-30.6-5.435v84.462c-70.392-12.692-126.005-68.305-138.698-138.697h84.462c-3.452-9.565-5.435-19.841-5.435-30.601 0-10.758 1.977-21.034 5.435-30.6h-84.462c12.694-70.392 68.306-126.004 138.698-138.697" />
            <circle cx="276.062" cy="276.061" r="38.25" />
          </svg></button>
        <button class="use-button"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="30" height="30"
            viewBox="0 0 512 512">
            <path
              d="M0 0 C22.48212276 18.97924244 36.63858712 45.54002163 39.15234375 75.01953125 C40.69526044 99.51803775 34.74878576 126.58295524 18.3125 145.5625 C19.10914063 146.25214844 19.90578125 146.94179687 20.7265625 147.65234375 C26.35896564 152.61642045 31.33985242 157.27197239 35.2265625 163.78515625 C36.3128134 165.71929804 36.3128134 165.71929804 38.3125 167.5625 C40.89921912 167.1255572 40.89921912 167.1255572 43.8125 166.1875 C55.86579174 162.97328887 66.82538306 164.56897751 78 170.1875 C86.05533955 174.87868763 92.21763965 181.19474188 96.3125 189.5625 C97.19550781 189.3459375 98.07851563 189.129375 98.98828125 188.90625 C112.96188542 185.66425376 125.78213195 184.96116254 138.625 192.375 C140.20567557 193.41026675 141.76986056 194.47136479 143.3125 195.5625 C143.94929688 196.00335938 144.58609375 196.44421875 145.2421875 196.8984375 C153.65305265 203.36545826 158.61105011 213.49819979 161.3125 223.5625 C161.85973036 228.40407035 161.86013732 233.19874615 161.83007812 238.06738281 C161.83551122 239.49293224 161.8426405 240.91847603 161.85131836 242.3440094 C161.86942052 246.18529412 161.86253732 250.02614494 161.84980202 253.86743641 C161.83959786 257.91096383 161.84908883 261.95445678 161.85534668 265.99798584 C161.86260501 272.78990263 161.85308677 279.58164493 161.83398438 286.37353516 C161.81225418 294.18923328 161.81924614 302.00451329 161.84129 309.82020116 C161.85953812 316.56373738 161.86195565 323.30714888 161.85153532 330.05070186 C161.84534721 334.06352618 161.84433306 338.07615515 161.85768127 342.08896637 C161.86937603 345.86820612 161.86097064 349.64691627 161.83810425 353.42609978 C161.83043041 355.44725219 161.84205819 357.46845027 161.85461426 359.48957825 C161.68483653 378.17839257 155.39313668 394.72637145 142.421875 408.234375 C139.05350072 411.95206217 136.46141925 416.03674583 134.3125 420.5625 C134.04397217 421.12388672 133.77544434 421.68527344 133.4987793 422.26367188 C130.04073729 430.75746833 130.87011146 440.2555691 130.87670898 449.2734375 C130.85704769 461.73083441 130.19732382 472.43058881 121.10546875 481.91015625 C114.48053682 488.01548567 108.08172492 489.86419667 99.23080444 489.84338379 C98.03525041 489.85229716 98.03525041 489.85229716 96.81554377 489.86139059 C94.15351612 489.87868826 91.49166916 489.88177452 88.82958984 489.88476562 C86.91716125 489.8940275 85.00473633 489.90407757 83.09231567 489.91485596 C77.9019495 489.94105724 72.71163501 489.953985 67.52121305 489.96287727 C64.27507684 489.96874704 61.02895462 489.97695827 57.78282547 489.98588562 C47.61668095 490.01322486 37.45056858 490.03256269 27.28438985 490.0402894 C15.56732182 490.04924486 3.85072112 490.08431793 -7.86620486 490.14229059 C-16.93481315 490.18559506 -26.00329032 490.20570176 -35.07200086 490.20837164 C-40.48276021 490.21046292 -45.89307995 490.22217395 -51.30373001 490.25801086 C-56.39781428 490.29109525 -61.49113142 490.29522504 -66.58528519 490.27773285 C-68.44761213 490.27619853 -70.30998135 490.28479271 -72.17220306 490.30464935 C-83.73060431 490.42059768 -93.51183564 489.87822064 -102.66817665 481.81919098 C-111.59915675 472.5950759 -111.81662849 460.86843137 -111.86328125 448.8125 C-111.88649331 446.48827233 -111.91061119 444.16405357 -111.93554688 441.83984375 C-111.9704909 438.21104067 -111.99992535 434.58256333 -112.01342773 430.95361328 C-112.0317604 411.40190809 -112.0317604 411.40190809 -116.6875 392.5625 C-116.95892822 391.82483398 -117.23035645 391.08716797 -117.51000977 390.32714844 C-121.29817156 381.03174392 -127.35195837 373.22437622 -133.6875 365.5625 C-134.80995669 364.19536246 -135.93234942 362.82817241 -137.0546875 361.4609375 C-138.84752176 359.28118551 -140.64276353 357.10356405 -142.44360352 354.93041992 C-146.09232087 350.52458013 -149.6748746 346.07742758 -153.1875 341.5625 C-157.26652778 336.32127844 -161.45110634 331.17728198 -165.6875 326.0625 C-170.37708426 320.40056134 -174.98893906 314.69222686 -179.49072266 308.87988281 C-182.03073511 305.61695091 -184.63209255 302.42121904 -187.3046875 299.265625 C-200.39476623 283.78781266 -206.37644867 271.13495588 -204.6875 250.5625 C-202.64689993 238.92591351 -195.71503513 228.94349759 -186.1875 222.0625 C-174.70790007 215.17474004 -162.45793216 212.62830811 -149.234375 215.24609375 C-133.2389881 219.81349688 -124.74522856 229.50477144 -112.6875 241.5625 C-112.3575 220.4425 -112.0275 199.3225 -111.6875 177.5625 C-113.6675 176.9025 -115.6475 176.2425 -117.6875 175.5625 C-142.65659574 161.43105432 -160.56015058 138.62778568 -168.68359375 111.19921875 C-173.75206159 91.7256318 -173.88948492 69.79578198 -167.6875 50.5625 C-167.47851074 49.9142627 -167.26952148 49.26602539 -167.05419922 48.59814453 C-158.28611922 22.53034713 -139.77574348 1.6044428 -115.6875 -11.4375 C-77.77059103 -30.03012733 -33.05999236 -26.36658761 0 0 Z M-120.6875 31.5625 C-121.43128906 32.27148438 -122.17507812 32.98046875 -122.94140625 33.7109375 C-135.50447978 46.54444902 -140.99636817 64.99629038 -141.1875 82.5625 C-140.97239086 102.33237417 -134.11153193 119.7959449 -120.3984375 134.01171875 C-118.47015537 135.8260822 -116.55351998 137.53882106 -114.51806641 139.22192383 C-113.58397949 139.99431396 -112.64989258 140.7667041 -111.6875 141.5625 C-111.67941315 140.81240662 -111.67132629 140.06231323 -111.66299438 139.28948975 C-111.5845852 132.17047434 -111.49716101 125.05163738 -111.39997292 117.93285751 C-111.35033306 114.27428621 -111.3040045 110.61573937 -111.265625 106.95703125 C-111.22835855 103.41665253 -111.18189595 99.87649635 -111.12943649 96.33631134 C-111.1022785 94.34926227 -111.08429439 92.36209448 -111.06655884 90.37493896 C-110.82274932 75.15494759 -108.94436717 61.73679685 -98.4375 50.0625 C-86.69343123 39.38607385 -75.30701937 35.84232041 -59.62744141 36.42626953 C-49.32918081 37.14945471 -38.60605062 42.99035358 -31.6875 50.5625 C-24.45741807 60.20760929 -20.64868728 69.94507836 -20.48217773 82.00512695 C-20.4522599 83.92655266 -20.4522599 83.92655266 -20.42173767 85.88679504 C-20.40475722 87.27478924 -20.38787827 88.66278467 -20.37109375 90.05078125 C-20.35050576 91.47853675 -20.32950882 92.90628641 -20.30812073 94.33403015 C-20.25309047 98.08056895 -20.20359773 101.82716101 -20.15527344 105.5737915 C-20.10491879 109.40145574 -20.04930582 113.22904323 -19.99414062 117.05664062 C-19.88679224 124.55852863 -19.78529613 132.06048074 -19.6875 139.5625 C-5.8777994 131.49277969 2.18523936 114.76272607 6.3671875 99.78515625 C11.07804951 80.37151742 6.9644742 60.93129491 -2.71484375 43.73046875 C-13.78745307 25.94851596 -30.780736 13.98756168 -51.07421875 9.24609375 C-77.71694607 4.20557777 -101.66565109 12.62068692 -120.6875 31.5625 Z M-78 73 C-81.074875 77.66925462 -80.81224735 82.41809708 -80.81207275 87.89201355 C-80.8134829 88.62018589 -80.81489305 89.34835823 -80.81634593 90.09859639 C-80.81998965 92.53344255 -80.81666637 94.96823013 -80.81347656 97.40307617 C-80.81487185 99.15111334 -80.81677151 100.89915016 -80.81913757 102.64718628 C-80.82363081 106.4099829 -80.82549058 110.17276862 -80.82559967 113.93556786 C-80.8267414 119.89101797 -80.83959031 125.84640628 -80.85516357 131.80183411 C-80.85773643 132.80768356 -80.86030928 133.81353301 -80.8629601 134.84986275 C-80.8682266 136.90662071 -80.87351208 138.96337862 -80.87881613 141.02013648 C-80.91389928 154.8820049 -80.94047922 168.74379636 -80.93798828 182.60571289 C-80.93639773 191.95992406 -80.95248085 201.3139242 -80.98869491 210.66806775 C-81.00712355 215.61480548 -81.01652475 220.56119099 -81.00421906 225.50795555 C-80.99274735 230.164552 -81.00456768 234.82051877 -81.03385353 239.47703171 C-81.04047085 241.18052217 -81.03866735 242.88407069 -81.02755547 244.58753777 C-80.96263691 255.4454585 -81.61721954 264.13847905 -89.375 272.4375 C-97.14601031 277.42267642 -104.41139199 279.82681888 -113.6875 278.5625 C-123.94412949 276.20519246 -130.51824023 269.01653753 -137.40625 261.55859375 C-138.06149658 260.84993164 -138.71674316 260.14126953 -139.3918457 259.41113281 C-140.68729022 257.99942841 -141.97279667 256.5785216 -143.24682617 255.14746094 C-147.48923718 250.47939186 -151.57708036 246.54495531 -157.91015625 245.03125 C-164.31567851 245.14004868 -167.64929441 247.46920778 -172 251.9375 C-174.66958344 256.09018535 -174.99587173 259.04753424 -174.015625 263.86328125 C-172.54042149 267.9721569 -170.45331514 270.70642839 -167.5625 273.875 C-166.55623631 275.01990664 -165.55103411 276.16574706 -164.546875 277.3125 C-164.05509766 277.86808594 -163.56332031 278.42367187 -163.05664062 278.99609375 C-161.24248051 281.07163785 -159.52190166 283.21267995 -157.8125 285.375 C-154.37025712 289.71827987 -150.87760532 294.01793504 -147.375 298.3125 C-143.28163721 303.33593216 -139.23367852 308.38919955 -135.25 313.5 C-131.14805088 318.76003113 -126.94121139 323.92456431 -122.6875 329.0625 C-85.89705587 373.57384011 -81.84139719 396.09815455 -80.6875 459.5625 C-21.2875 459.5625 38.1125 459.5625 99.3125 459.5625 C99.6425 448.6725 99.9725 437.7825 100.3125 426.5625 C105.00080896 408.98134139 105.00080896 408.98134139 108 403.25 C108.3388623 402.58468262 108.67772461 401.91936523 109.02685547 401.23388672 C111.76099928 396.09848392 115.14628437 392.03121678 119.203125 387.85546875 C128.63142673 377.60655557 130.76520445 366.46250244 130.71655273 352.96801758 C130.72226554 351.61683084 130.7292333 350.26564892 130.73735046 348.91447449 C130.7551895 345.27002222 130.754132 341.6258119 130.74840808 337.9813292 C130.745305 334.93192796 130.75142054 331.88257245 130.75744683 328.83317775 C130.77145785 321.63980392 130.76995731 314.44654896 130.75854492 307.25317383 C130.74704628 299.84178743 130.76117621 292.43076217 130.7879414 285.01942331 C130.81010657 278.64210494 130.81673457 272.2648999 130.81086498 265.88754576 C130.80749864 262.08455248 130.80988975 258.28179107 130.82711601 254.47883034 C130.84259811 250.90566956 130.83861636 247.33304457 130.81981087 243.75990486 C130.81437788 241.82882984 130.82862642 239.89773066 130.84350586 237.96670532 C130.77320237 229.69972798 129.8252536 226.17283009 124.0625 220.25 C120.48734305 218.05615369 117.49763115 217.35653882 113.3125 217.5625 C108.59780148 219.22651124 105.58729617 221.8198758 102.3125 225.5625 C101.16512407 229.00462779 101.16971005 231.72571418 101.13671875 235.35546875 C101.11350423 236.72202034 101.08938625 238.08855682 101.06445312 239.45507812 C101.02949953 241.59653608 101.00007919 243.73744328 100.98657227 245.87915039 C100.87398293 260.82928163 100.87398293 260.82928163 96.3125 267.5625 C91.67768059 271.01166793 86.89611371 271.30297924 81.3125 270.5625 C77.11109335 269.00642346 74.61001878 267.43200532 72.3125 263.5625 C71.32641075 260.60423226 71.18267678 258.66093873 71.1706543 255.57543945 C71.16010262 254.05289299 71.16010262 254.05289299 71.14933777 252.49958801 C71.14517349 251.40273178 71.14100922 250.30587555 71.13671875 249.17578125 C71.11351454 246.85220454 71.08939696 244.52863681 71.06445312 242.20507812 C71.02938615 238.54266405 71.00002048 234.88057886 70.98657227 231.21801758 C70.97105078 227.68269971 70.93080614 224.14834351 70.88671875 220.61328125 C70.88958138 218.98317863 70.88958138 218.98317863 70.89250183 217.32014465 C70.76744548 209.50330204 69.52307637 204.0406244 64.0625 198.125 C60.50659007 196.10459663 57.36375311 195.25660428 53.3125 195.5625 C48.700904 196.90998994 45.90534123 198.83284926 42.875 202.5625 C40.69455161 206.74896092 40.18887249 209.99927691 40.1706543 214.69482422 C40.16361984 215.71623505 40.15658539 216.73764587 40.14933777 217.79000854 C40.14309135 219.43696213 40.14309135 219.43696213 40.13671875 221.1171875 C40.11352428 223.44662366 40.0894071 225.77605078 40.06445312 228.10546875 C40.02931911 231.77463875 39.99997817 235.44347507 39.98657227 239.11279297 C39.97109517 242.65633371 39.93089085 246.19890344 39.88671875 249.7421875 C39.88862717 250.83610809 39.89053558 251.93002869 39.89250183 253.05709839 C39.79422403 259.18177067 39.4693321 262.93387292 35.3125 267.5625 C30.78106432 270.65211523 26.65207883 271.36183815 21.3125 270.5625 C17.72976492 269.14292572 14.63367274 267.6960832 12.3125 264.5625 C10.45227865 259.96157213 10.0277746 255.81252325 10.05712891 250.90820312 C10.05169823 249.79480812 10.05169823 249.79480812 10.04615784 248.65892029 C10.03929479 247.05643436 10.03675257 245.45392522 10.03810501 243.85142517 C10.03907464 241.31196422 10.02607772 238.77292144 10.00912476 236.23352051 C9.96297742 229.01687814 9.93824247 221.80028109 9.93164062 214.58349609 C9.9266204 210.16084978 9.90234988 205.73864388 9.86631393 201.31614685 C9.85653261 199.63531643 9.85417489 197.95442532 9.85948563 196.27357483 C9.86657289 193.92083755 9.84924323 191.5694104 9.82666016 189.21679688 C9.83483261 188.52778793 9.84300507 187.83877899 9.85142517 187.12889099 C9.76708058 182.17444596 8.37903063 179.39602476 5.3125 175.5625 C1.15584206 171.88917438 -2.10301097 170.91710321 -7.5078125 171.171875 C-11.87907502 171.95525538 -14.64477184 174.37594726 -17.5 177.625 C-19.94052584 181.60691057 -19.83849751 185.36636035 -19.84521484 189.8762207 C-19.85029556 190.61804596 -19.85537628 191.35987122 -19.86061096 192.12417603 C-19.8713083 193.73490024 -19.87993098 195.34563927 -19.88673019 196.95638466 C-19.89852926 199.50812641 -19.91798519 202.05969968 -19.93984985 204.6113739 C-20.00142842 211.86642837 -20.0554812 219.12146566 -20.08886719 226.37670898 C-20.10984153 230.81531287 -20.14516752 235.25360953 -20.18962479 239.69203758 C-20.20376377 241.38123134 -20.21250248 243.07047945 -20.21567917 244.75972939 C-20.22060172 247.12701057 -20.24379355 249.49348015 -20.27099609 251.8605957 C-20.26648689 252.90117882 -20.26648689 252.90117882 -20.2618866 253.96278381 C-20.34009059 258.55789836 -21.46683739 261.57963845 -23.6875 265.5625 C-23.6875 266.2225 -23.6875 266.8825 -23.6875 267.5625 C-24.47125 267.871875 -25.255 268.18125 -26.0625 268.5 C-28.61080128 269.49125038 -28.61080128 269.49125038 -30.6875 270.5625 C-37.17575463 271.36857644 -41.47247845 270.52591638 -46.6875 266.5625 C-49.51692046 262.03647584 -50.11851081 258.19760816 -50.06604004 252.97192383 C-50.07057017 252.22782414 -50.0751003 251.48372446 -50.0797677 250.7170763 C-50.09135537 248.2343811 -50.08175967 245.75222846 -50.07226562 243.26953125 C-50.07637238 241.48529717 -50.08183387 239.70106578 -50.08854675 237.9168396 C-50.10026102 234.07980116 -50.10275994 230.24290652 -50.09819031 226.40585327 C-50.09137761 220.33795844 -50.10725349 214.27025268 -50.12658691 208.20239258 C-50.1676524 194.22710134 -50.17898738 180.25181536 -50.19011688 166.276474 C-50.20062395 153.46660263 -50.21739793 140.65682211 -50.25821257 127.8470068 C-50.2765716 121.81561837 -50.28046023 115.78444621 -50.27327728 109.7530365 C-50.27175553 106.00079463 -50.28253852 102.24866101 -50.29665565 98.49644852 C-50.30065839 96.75740594 -50.29953313 95.01834279 -50.29288292 93.27930832 C-50.28449632 90.90363306 -50.29449696 88.52870643 -50.30895996 86.15307617 C-50.30206603 85.46649335 -50.29517209 84.77991053 -50.28806925 84.07252216 C-50.35953157 78.03884526 -52.22462654 74.20823264 -56.1875 69.75 C-59.80803215 66.58203437 -62.8687372 66.21137596 -67.62890625 66.28125 C-72.16527738 66.90101987 -74.96958742 69.80578134 -78 73 Z "
              transform="translate(321.6875,22.4375)" />
            <path
              d="M0 0 C3.86098899 3.08556024 6.14347421 5.79257775 6.9296875 10.8046875 C7.28103792 18.18304642 4.34240348 22.81893395 0.51586914 28.8684082 C-3.6585893 35.54207625 -6.53461204 42.36825827 -9.0703125 49.8046875 C-9.410625 50.76761719 -9.7509375 51.73054688 -10.1015625 52.72265625 C-16.37697095 74.25079358 -12.45142639 98.3606964 -2.0703125 117.8046875 C-1.0087265 119.62354819 0.07262854 121.42964549 1.15600586 123.2355957 C7.71769354 134.22483708 7.71769354 134.22483708 6.9296875 140.8046875 C5.31462555 146.50490615 2.94632458 149.64606415 -2.0703125 152.8046875 C-6.70700027 154.17289045 -10.19075183 154.0685557 -14.8203125 152.6796875 C-20.59091743 149.35049235 -24.09661554 144.71081433 -27.4453125 139.0546875 C-27.83033936 138.40491943 -28.21536621 137.75515137 -28.61206055 137.08569336 C-43.71316381 110.864034 -48.93443437 77.83873137 -42.0390625 48.24609375 C-41.719375 47.11042969 -41.3996875 45.97476563 -41.0703125 44.8046875 C-40.73 43.57621094 -40.3896875 42.34773438 -40.0390625 41.08203125 C-36.08416139 28.16179687 -28.96569634 8.10267512 -17.58203125 0.04296875 C-11.90248503 -2.75705637 -5.64778792 -3.26079831 0 0 Z "
              transform="translate(64.0703125,29.1953125)" />
            <path
              d="M0 0 C0.74121094 0.06703125 1.48242188 0.1340625 2.24609375 0.203125 C7.32873507 1.40307405 10.0452223 3.93093086 12.84667969 8.27905273 C13.20665039 8.86759033 13.56662109 9.45612793 13.9375 10.0625 C14.32325195 10.68133057 14.70900391 11.30016113 15.10644531 11.93774414 C21.84676661 22.93459782 27.06652252 34.31558925 30.5625 46.75 C30.88347656 47.88824219 31.20445312 49.02648437 31.53515625 50.19921875 C39.12545235 82.85514383 31.81422479 116.60356119 14.671875 144.8671875 C10.78445567 150.69831649 7.78774162 154.07373966 0.6875 155.5625 C-4.15928265 155.97247222 -8.20689031 155.47822012 -12.171875 152.40625 C-16.02143244 148.52003011 -17.50349813 144.80581201 -17.734375 139.35546875 C-17.08467732 133.65351672 -13.92419218 129.12948383 -10.94140625 124.35546875 C-6.83276558 117.74962829 -3.89899213 111.13447638 -1.4375 103.75 C-1.11523438 102.82445312 -0.79296875 101.89890625 -0.4609375 100.9453125 C6.14488468 78.16448648 1.49679634 53.60942456 -9.50390625 33.140625 C-11.04097481 30.44532094 -12.63394559 27.87613954 -14.375 25.3125 C-16.96536657 21.32596975 -17.71891079 17.48281775 -17.4375 12.75 C-15.77152505 6.87008841 -13.31164712 4.13206127 -8.4375 0.75 C-5.49469273 -0.24695103 -3.07766789 -0.32003479 0 0 Z "
              transform="translate(458.4375,27.25)" />
            <path
              d="M0 0 C3.67627829 2.22631146 5.92886643 5.09932236 8.1328125 8.7421875 C8.51252197 9.35215576 8.89223145 9.96212402 9.28344727 10.59057617 C19.74043408 28.03378671 22.81881944 50.11471617 17.9453125 69.8671875 C14.70877002 81.02925626 9.46460744 94.52767798 -0.3671875 101.3671875 C-5.93180955 103.14786656 -10.40496792 103.09929606 -15.7421875 100.8671875 C-20.17371772 98.39844133 -22.03879724 95.14261265 -23.4921875 90.3671875 C-24.60799177 83.67236185 -21.63016149 79.0530891 -18.4921875 73.3671875 C-17.75408779 71.97605719 -17.02412734 70.58055903 -16.3046875 69.1796875 C-16.00175781 68.60863281 -15.69882812 68.03757812 -15.38671875 67.44921875 C-10.71107858 56.56661521 -11.03494204 44.0899865 -15.20703125 33.12890625 C-16.95013511 29.38308732 -18.97555048 25.89030635 -21.22265625 22.42578125 C-23.70980686 18.39277088 -23.87365676 15.02111244 -23.4921875 10.3671875 C-22.12192608 5.94272894 -20.22891975 2.44987989 -16.3046875 -0.1328125 C-10.65991416 -2.84036973 -5.59319134 -2.61516105 0 0 Z "
              transform="translate(412.4921875,54.6328125)" />
            <path
              d="M0 0 C3.94693079 2.59763119 5.76548471 6.07502301 7.1875 10.5 C8.30330427 17.19482565 5.32547399 21.8140984 2.1875 27.5 C1.44940029 28.89113031 0.71943984 30.28662847 0 31.6875 C-0.30292969 32.25855469 -0.60585937 32.82960937 -0.91796875 33.41796875 C-5.59360892 44.30057229 -5.26974546 56.777201 -1.09765625 67.73828125 C0.64544761 71.48410018 2.67086298 74.97688115 4.91796875 78.44140625 C7.39813508 82.46309134 7.50198499 85.86134636 7.1875 90.5 C5.14432161 96.17549553 1.59002559 99.79873721 -3.8125 102.5 C-5.73046875 102.73828125 -5.73046875 102.73828125 -8 102.8125 C-9.10408203 102.86857422 -9.10408203 102.86857422 -10.23046875 102.92578125 C-15.54267358 102.04978983 -18.9311627 99.55371241 -22.2890625 95.5390625 C-23.02582813 94.41428133 -23.74147981 93.27543999 -24.4375 92.125 C-24.81720947 91.51503174 -25.19691895 90.90506348 -25.58813477 90.27661133 C-36.04512158 72.83340079 -39.12350694 50.75247133 -34.25 31 C-31.00786507 19.81864421 -25.76488989 6.4439217 -16 -0.5 C-10.49899335 -2.22580601 -5.29658751 -2.55736521 0 0 Z "
              transform="translate(115.8125,54.5)" />
          </svg></button>
      </div>
    </div>

    <div class="weblyne-footer">
      <div class="weblyne-controls">
        <button class="weblyne-button weblyne-refresh-button" aria-label="Go Back to Main Menu" id="refresh-button">
          <svg class="weblyne-refresh-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M7 12v-2l-4 3 4 3v-2h2.997A6.006 6.006 0 0 0 16 8h-2a4 4 0 0 1-3.996 4H7zM9 2H6.003A6.006 6.006 0 0 0 0 8h2a4 4 0 0 1 3.996-4H9v2l4-3-4-3v2z"
              fill-rule="evenodd" />
          </svg>
        </button>
        <button class="weblyne-button weblyne-back-button" aria-label="Refresh challenge" id="back-button">
          <svg class="weblyne-back-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M2.61422,5.42597 C2.8464,4.86546 3.39335,4.5 4.00004,4.5 L13.9999979,4.5 C18.1422,4.5 21.4999979,7.85786 21.4999979,12 C21.4999979,16.1421 18.1422,19.5 13.9999979,19.5 L5.00004,19.5 C4.17162,19.5 3.50004,18.8284 3.50004,18 C3.50004,17.1716 4.17162,16.5 5.00004,16.5 L13.9999979,16.5 C16.4853,16.5 18.4999979,14.4853 18.4999979,12 C18.4999979,9.51472 16.4853,7.5 13.9999979,7.5 L7.62136,7.5 L8.5607,8.43934 C9.14649,9.02513 9.14649,9.97487 8.5607,10.5607 C7.97492,11.1464 7.02517,11.1464 6.43938,10.5607 L2.93938,7.06066 C2.51039,6.63166 2.38205,5.98649 2.61422,5.42597 Z"
              fill-rule="evenodd" />
          </svg>
        </button>
      </div>
      <div class="status-message focus">Tap to play</div>
      <div class="status-message death">You died! Try again</div>
      <div class="status-message instructions">Press <code class="weblyne-key">F1</code> for Help</div>
      <button class="weblyne-button weblyne-killcount-button" aria-label="0 Monsters Killed" id="killcount-button">
        <svg class="weblyne-killcount-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M19 21C19 21.5523 18.5523 22 18 22H14H10H6C5.44771 22 5 21.5523 5 21V18.75C5 17.7835 4.2165 17 3.25 17C2.55964 17 2 16.4404 2 15.75V11C2 5.47715 6.47715 1 12 1C17.5228 1 22 5.47715 22 11V15.75C22 16.4404 21.4404 17 20.75 17C19.7835 17 19 17.7835 19 18.75V21ZM17 20V18.75C17 16.9358 18.2883 15.4225 20 15.075V11C20 6.58172 16.4183 3 12 3C7.58172 3 4 6.58172 4 11V15.075C5.71168 15.4225 7 16.9358 7 18.75V20H9V18C9 17.4477 9.44771 17 10 17C10.5523 17 11 17.4477 11 18V20H13V18C13 17.4477 13.4477 17 14 17C14.5523 17 15 17.4477 15 18V20H17ZM11 12.5C11 13.8807 8.63228 15 7.25248 15C5.98469 15 5.99206 14.055 6.00161 12.8306V12.8305C6.00245 12.7224 6.00331 12.6121 6.00331 12.5C6.00331 11.1193 7.12186 10 8.50166 10C9.88145 10 11 11.1193 11 12.5ZM17.9984 12.8306C17.9975 12.7224 17.9967 12.6121 17.9967 12.5C17.9967 11.1193 16.8781 10 15.4983 10C14.1185 10 13 11.1193 13 12.5C13 13.8807 15.3677 15 16.7475 15C18.0153 15 18.0079 14.055 17.9984 12.8306Z"
            fill="#888888" />
        </svg>
        <span>0</span>
      </button>
    </div>
  </div>

  <script>
    window.va =
      window.va ||
      function () {
        (window.vaq = window.vaq || []).push(arguments);
      };
  </script>
  <script>

    // Handle taps outside the canvas container
    document.addEventListener("touchstart", (e) => {
      const canvasContainer = document.querySelector(
        ".weblyne-canvas-container",
      );
      if (
        !canvasContainer.contains(e.target) &&
        weblyneContainer.matches(":focus")
      ) {
        weblyneContainer.blur();
      }
    });

    const canvas = document.getElementById("canvas");
    const statusElement = document.getElementById("status");
    const progressElement = document.getElementById("progress");
    const killcountButton = document.getElementById("killcount-button");
    const weblyneContainer = document.querySelector(".weblyne-container");
    const refreshButton = document.getElementById("refresh-button");
    const backButton = document.getElementById("back-button");
    let isDebugActive = false;
    let enemiesKilled = 0;

    function restartGame() {
      enemiesKilled = 0;
      updatekillcountButton();

      // Track game start
      va("event", { name: "game_start" });

      // Call the native DOOM restart function directly
      Module["_G_DoReborn"]();
    }

    function updatekillcountButton() {
      const killcountSpan = killcountButton.querySelector("span");
      killcountSpan.textContent = `${enemiesKilled}`;
      killcountButton.setAttribute(
        "aria-label",
        `killcount, ${enemiesKilled} monsters killed`,
      );

      killcountButton.style.backgroundColor = "#f0f0f0";
      killcountButton.style.color = "#888";
      killcountButton.style.cursor = "default";
    }

    // prevent losing focus when it's tapped
    refreshButton.addEventListener("mousedown", (e) => {
      e.preventDefault();
    });

    refreshButton.addEventListener("click", (e) => {
      e.preventDefault();
      weblyneContainer.focus();
      restartGame();
    });

    // prevent losing focus when it's tapped
    backButton.addEventListener("mousedown", (e) => {
      e.preventDefault();
    });

    backButton.addEventListener("click", (e) => {
      e.preventDefault();
      location.href = 'https://voltarius.voltaccept.com';
    });

    function showSuccess() {

      // Track successful solve
      va("event", { name: "weblyne_solved", data: { kills: enemiesKilled } });

      // Pause the game
      Module.pauseMainLoop();

      // Hide the weblyne container completely
      weblyneContainer.style.display = "none";

      // Show success message outside the container
      const successDiv = document.createElement("div");
      successDiv.className = "success-message";
      successDiv.style.display = "block";
      successDiv.innerHTML = `
        <h2>WebLyne solved!</h2>
        <a href="https://voltarius.voltaccept.com">Go Back ↩</a>
      `;
      document.body.appendChild(successDiv);

      // Lazy load and trigger confetti
      const script = document.createElement("script");
      script.src =
        "https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";
      script.onload = () => {
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.5 },
        });
      };
      script.onerror = () => {

      };
      document.body.appendChild(script);
    }

    weblyneContainer.addEventListener("focus", () => {
      va("event", { name: "game_resume" });
      Module.resumeMainLoop();
    });

    weblyneContainer.addEventListener("blur", () => {
      va("event", { name: "game_pause" });
      Module.pauseMainLoop();
    });

    // Mobile controls handling
    const mobileControls = {
      up: { keyCode: 38 }, // Arrow Up
      down: { keyCode: 40 }, // Arrow Down
      left: { keyCode: 37 }, // Arrow Left
      right: { keyCode: 39 }, // Arrow Right
      fire: { keyCode: 17 }, // CTRL
      use: { keyCode: 32 }, // Space
    };

    function ensureGameFocused() {
      if (!weblyneContainer.matches(":focus")) {
        weblyneContainer.focus();
      }
    }

    function simulateKeyEvent(type, keyCode) {
      const event = new KeyboardEvent(type, {
        keyCode: keyCode,
        bubbles: true,
        cancelable: true,
      });
      weblyneContainer.dispatchEvent(event);
    }

    function handleTouchStart(key) {
      return (e) => {
        e.preventDefault();
        ensureGameFocused();
        simulateKeyEvent("keydown", mobileControls[key].keyCode);
      };
    }

    function handleTouchEnd(key) {
      return (e) => {
        e.preventDefault();
        ensureGameFocused();
        simulateKeyEvent("keyup", mobileControls[key].keyCode);
      };
    }

    // Ensure controls are clickable even when game is not focused
    document.querySelector(".mobile-controls").addEventListener(
      "touchstart",
      (e) => {
        ensureGameFocused();
      },
      { passive: false },
    );

    // Setup touch controls
    document
      .querySelectorAll(".d-pad button, .fire-button, .use-button")
      .forEach((button) => {
        let key = button.className.split(" ")[0];
        if (!key || key === "fire-button") key = "fire";
        if (!key || key === "use-button") key = "use";

        button.addEventListener("touchstart", handleTouchStart(key));
        button.addEventListener("touchend", handleTouchEnd(key));
        button.addEventListener("touchcancel", handleTouchEnd(key));
      });

    // Setup gamepad controls
    let gamepadIndex;
    let toggleIndex = 0;
    let button3Pressed = false;

    window.addEventListener("gamepadconnected", (event) => {
      gamepadIndex = event.gamepad.index;
      document.getElementById("status").textContent = `Gamepad connected: ${event.gamepad.id}`;
      console.log(`Gamepad connected at index ${gamepadIndex}: ${event.gamepad.id}`);
      updateGamepad();
    });

    window.addEventListener("gamepaddisconnected", () => {
      document.getElementById("status").textContent = "Gamepad disconnected.";
      console.log("Gamepad disconnected.");
    });

    function updateGamepad() {
      const gamepad = navigator.getGamepads()[gamepadIndex];
      if (gamepad) {
        if (gamepad.buttons[2].pressed) {
          simulateKeyEvent("keydown", 32);
        }
        if (!gamepad.buttons[2].pressed) {
          simulateKeyEvent("keyup", 32);
        }
        if (gamepad.buttons[7].pressed) {
          simulateKeyEvent("keydown", 17);
        }
        if (!gamepad.buttons[7].pressed) {
          simulateKeyEvent("keyup", 17);
        }
        if (gamepad.buttons[15].pressed) {
          simulateKeyEvent("keydown", 39);
        }
        if (!gamepad.buttons[15].pressed) {
          simulateKeyEvent("keyup", 39);
        }
        if (gamepad.buttons[14].pressed) {
          simulateKeyEvent("keydown", 37);
        }
        if (!gamepad.buttons[14].pressed) {
          simulateKeyEvent("keyup", 37);
        }
        if (gamepad.buttons[13].pressed) {
          simulateKeyEvent("keydown", 40);
        }
        if (!gamepad.buttons[13].pressed) {
          simulateKeyEvent("keyup", 40);
        }
        if (gamepad.buttons[12].pressed) {
          simulateKeyEvent("keydown", 38);
        }
        if (!gamepad.buttons[12].pressed) {
          simulateKeyEvent("keyup", 38);
        }

        //Weapon Scroll
        if (gamepad.buttons[3].pressed && !button3Pressed) {
          button3Pressed = true;

          simulateKeyEvent("keydown", 49 + toggleIndex);

          toggleIndex = (toggleIndex + 1) % 7;
        } else if (!gamepad.buttons[3].pressed && button3Pressed) {
          button3Pressed = false;

          simulateKeyEvent("keyup", 49 + (toggleIndex === 0 ? 6 : toggleIndex - 1));
        }

        // Continue updating
        requestAnimationFrame(updateGamepad);
      }
    }

    var Module = {
      keyboardListeningElement: weblyneContainer,
      arguments: [
      ],
      preRun: [
        function () {
          SDL.defaults.copyOnLock = false;

          // Store the original lookupKeyCodeForEvent function
          const originalLookupKeyCodeForEvent = SDL.lookupKeyCodeForEvent;

          // Create a wrapper that modifies key behavior
          SDL.lookupKeyCodeForEvent = function (event) {
            return originalLookupKeyCodeForEvent(event);
          };
        },
      ],
      postRun: [],
      onPlayerBorn: function () {
        document
          .querySelector(".status-message.death")
          .classList.remove("visible");
      },
      onPlayerDeath: function () {
        va("event", { name: "player_death", data: { kills: enemiesKilled } });
        enemiesKilled = 0;
        updatekillcountButton();
        document
          .querySelector(".status-message.death")
          .classList.add("visible");
      },
      onEnemyKilled: function () {
        enemiesKilled++;
        va("event", { name: "enemy_killed", data: { kills: enemiesKilled } });
        updatekillcountButton();

        // Get the icon path
        const iconPath = killcountButton.querySelector(
          ".weblyne-killcount-icon path",
        );

        // Reset animations
        killcountButton.style.animation = "none";
        iconPath.style.animation = "none";
        killcountButton.offsetHeight; // Trigger reflow

        // Set end colors based on kill count
        killcountButton.style.setProperty(
          "--end-color",
          "#f0f0f0",
        );
        iconPath.style.setProperty(
          "--end-icon-color",
          "#888888",
        );

        // Show success message when 5 enemies are killed
        // if (enemiesKilled === 5) {
        //   showSuccess();
        // }
      },
      print: function (text) {
        if (arguments.length > 1)
          text = Array.prototype.slice.call(arguments).join(" ");
        console.log(text);
      },
      printErr: function (text) {
        if (arguments.length > 1)
          text = Array.prototype.slice.call(arguments).join(" ");
        console.error(text);
      },
      canvas: canvas,
      setStatus: function (text) {
        if (!Module.setStatus.last)
          Module.setStatus.last = { time: Date.now(), text: "" };
        if (text === Module.setStatus.last.text) return;
        const m = text.match(/([^(]+)$$(\d+(\.\d+)?)\/(\d+)$$/);
        const now = Date.now();
        if (m && now - Module.setStatus.last.time < 30) return;
        Module.setStatus.last.time = now;
        Module.setStatus.last.time = now;
        Module.setStatus.last.text = text;
        if (m) {
          text = m[1];
          progressElement.value = parseInt(m[2]) * 100;
          progressElement.max = parseInt(m[4]) * 100;
          progressElement.hidden = false;
        } else {
          progressElement.value = null;
          progressElement.max = null;
          progressElement.hidden = true;
        }
        statusElement.innerHTML = text;
      },
      totalDependencies: 0,
      monitorRunDependencies: function (left) {
        this.totalDependencies = Math.max(this.totalDependencies, left);
        Module.setStatus(
          left
            ? "Preparing... (" +
            (this.totalDependencies - left) +
            "/" +
            this.totalDependencies +
            ")"
            : "All downloads complete.",
        );
      },
    };
    Module.setStatus("Downloading ...");
    window.onerror = function () {
      Module.setStatus("Exception thrown, see JavaScript console");
      Module.setStatus = function (text) {
        if (text) Module.printErr("[post-exception status] " + text);
      };
    };
  </script>
  <script async type="text/javascript" src="index.js"></script>
</body>

</html>

